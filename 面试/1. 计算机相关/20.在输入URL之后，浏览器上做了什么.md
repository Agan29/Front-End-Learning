
# 在浏览器上输入 url 之后的流程

我会大致上分成 获取资源 和 页面渲染 两个阶段。

## 阶段 1 获取资源

1. 进行 `url` 解析,查找 `url` 对应服务器的 `IP`, 如果没有在缓存中找到，则通过 `DNS` 系统进行 `IP` 查找
2. 根据 `IP` 就可以找到服务器,然后浏览器和服务器会进行 `TCP` 三次握手建立连接
3. 建立 `TCP` 连接,此时是 `https` 的话，还会建立 `TLS` 连接以及协商加密算法,之后发起 `http/https` 请求(http 和 https 的区别)
4. 连接建立之后浏览器开始发送请求获取文件，此时这里还会出现一种情况就是缓存，建立连接后是走缓存还是直接重新获取，需要看后台设置(浏览器缓存机制),直接获取或者通过缓存获取文件;
5. 浏览器解析 html

## 阶段 2 页面渲染

1. 首先获取 `html` 文件，构建 `DOM` 树,边下载边解析,解析到 `html` 头部时候，又会出现一种问题，`css,js` 放到哪里了？不同的位置会造成渲染的不同，此时就会出现另一个需要关注的问题(`css,js` 位置应该放哪里?为什么),先按照正确的位置来说明(css 放头部,js 放尾部);
2. 下载 `css` `文件，css` 文件也是一边下载一边解析的,构建的是 `CSSOM` 树,当 `DOM` 树和 `CSSOM` 树全部构建完之后(互不影响)
3. 生成 `CSSOM` 树和 `DOM` 树（互不影响），但 `script` 标签的加载阻塞 `DOM` 树的构建
4. 浏览器会把 `DOM` 树和 `CSSOM` 树构建成渲染树，`css` 文件则会阻塞渲染树的构建,构建渲染树的时候还做了以下事情
   1. 样式计算,`DOM` 树和 `CSSOM` 树有了之后，浏览器开始样式计算，主要是为 `DOM` 树上的节点找到对应的样式
   2. 构建布局树 `layout`，样式计算完之后就开始构建布局树。主要是为 `DOM` 树上的节点找到页面上对应位置以及一些"`display:none`"元素的隐藏。
   3. 构建分层树，布局树完成后浏览器还需要建立分层树，主要是为了满足滚动条，`z-index，position` 这些复杂的分层操作
   4. 将分层树图块化，利用光栅找到视图窗口下的对应的位图。主要是因为一个页面可能有几屏那么长，一下渲染出来比较浪费，所以浏览器会找到视图窗口对应的图块，将这部分的图块进行渲染
5. paint,最终渲染进程将整个页面渲染出来，在渲染的过程中会还出现重排和重绘，这也是比较爱问的问题(重排重绘为什么会影响渲染，如何避免?)
